"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var point_1 = require("../../lib/point");
var ctx = null;
var isTouching = false;
var backgroundColor = '#FEFEFE';
var pen = { color: '#333333', width: 1 };
var dpr = 1;
var timeLine = [];
Page({
    data: {},
    onLoad: function (options) {
        console.log('onLoad');
    },
    onReady: function () {
        this.initContext();
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    initContext: function () {
        var _a = wx.getSystemInfoSync(), pixelRatio = _a.pixelRatio, windowWidth = _a.windowWidth, windowHeight = _a.windowHeight;
        dpr = pixelRatio;
        console.log('pixelRatio', pixelRatio);
        var query = wx.createSelectorQuery();
        query.select('#canvas').node().exec(function (res) {
            var canvas = res[0].node;
            console.log('canvas --- ', canvas);
            canvas.width = windowWidth * dpr;
            canvas.height = windowHeight * dpr;
            ctx = canvas.getContext('2d');
            console.log('ctx', ctx);
            ctx.fillStyle = backgroundColor;
            ctx.fillRect(16, 16, ctx.canvas.width - 32, ctx.canvas.height - 32);
        });
    },
    onTouchStart: function (event) {
        console.log('touch start -- ', event);
        isTouching = true;
        this._strokeBegin(event);
    },
    onTouchMove: function (event) {
        console.log('touch move --', event);
        this._strokeUpdate(event);
    },
    onTouchEnd: function (event) {
        console.log('touch end --', event);
        isTouching = false;
        this._strokeEnd(event);
    },
    onTouchCancel: function (event) {
        console.log('touch cancel', event);
        isTouching = false;
        this._strokeEnd(event);
    },
    onError: function (event) {
        console.log('canvas error', event);
        isTouching = false;
        this._strokeEnd(event);
    },
    _strokeBegin: function (event) {
        var newPointGroup = {
            color: pen.color,
            points: [],
        };
        this._reset();
        timeLine.push(newPointGroup);
        var _a = event.touches[0], x = _a.x, y = _a.y;
        ctx.beginPath();
        this._moveTo(x, y);
        this._lineTo(x, y);
        this._strokeUpdate(event);
    },
    _strokeUpdate: function (event) {
        var _a = event.touches[0], x = _a.x, y = _a.y;
        this._lineTo(x, y);
        ctx.stroke();
    },
    _strokeEnd: function (event) {
        ctx.closePath();
    },
    _createPoint: function (x, y) {
        var _a = ctx.canvas, left = _a.left, top = _a.top;
        return new point_1.Point(x - left, y - top, new Date().getTime());
    },
    _drawDot: function () {
        ctx.beginPath();
        ctx.closePath();
        ctx.fillStyle = '#333333';
        ctx.fill();
    },
    _lineTo: function (x, y) {
        ctx.lineTo(x * dpr, y * dpr);
    },
    _moveTo: function (x, y) {
        ctx.moveTo(x * dpr, y * dpr);
    },
    _reset: function () {
        ctx.fillStyle = pen.color;
    },
    _clear: function () {
        ctx.fillStyle = backgroundColor;
        ctx.clearRect(16, 16, ctx.canvas.width - 32, ctx.canvas.height - 32);
        ctx.fillRect(16, 16, ctx.canvas.width - 32, ctx.canvas.height - 32);
        timeLine = [];
        this._reset();
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lnbmF0dXJlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic2lnbmF0dXJlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEseUNBQW1EO0FBS25ELElBQUksR0FBRyxHQUFRLElBQUksQ0FBQTtBQUVuQixJQUFJLFVBQVUsR0FBWSxLQUFLLENBQUE7QUFDL0IsSUFBSSxlQUFlLEdBQUcsU0FBUyxDQUFBO0FBQy9CLElBQUksR0FBRyxHQUFHLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUE7QUFDeEMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFBO0FBR1gsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFBO0FBRWpCLElBQUksQ0FBQztJQUtILElBQUksRUFBRSxFQUVMO0lBS0QsTUFBTSxFQUFFLFVBQVUsT0FBTztRQUN2QixPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ3ZCLENBQUM7SUFLRCxPQUFPLEVBQUU7UUFDUCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7SUFDcEIsQ0FBQztJQUtELE1BQU0sRUFBRTtJQUVSLENBQUM7SUFLRCxNQUFNLEVBQUU7SUFFUixDQUFDO0lBS0QsUUFBUSxFQUFFO0lBRVYsQ0FBQztJQUtELFdBQVc7UUFDSCxJQUFBLDJCQUFrRSxFQUFoRSwwQkFBVSxFQUFFLDRCQUFXLEVBQUUsOEJBQXVDLENBQUE7UUFDeEUsR0FBRyxHQUFHLFVBQVUsQ0FBQTtRQUNoQixPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxVQUFVLENBQUMsQ0FBQTtRQUVyQyxJQUFNLEtBQUssR0FBRyxFQUFFLENBQUMsbUJBQW1CLEVBQUUsQ0FBQTtRQUN0QyxLQUFLLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFDLEdBQUc7WUFDdEMsSUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElB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QUFFLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsRUFBRSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQyxDQUFBO1FBQ25FLFFBQVEsR0FBRyxFQUFFLENBQUE7UUFDYixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUE7SUFDZixDQUFDO0NBRUYsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gbWluaXByb2dyYW0vcGFnZXMvc2lnbmF0dXJlLmpzXG5pbXBvcnQgeyBCZXppZXIgfSBmcm9tICcuLi8uLi9saWIvYmV6aWVyJ1xuaW1wb3J0IHsgQmFzaWNQb2ludCwgUG9pbnQgfSBmcm9tICcuLi8uLi9saWIvcG9pbnQnXG5pbXBvcnQgeyB0aHJvdHRsZSB9IGZyb20gJy4uLy4uL2xpYi90aHJvdHRsZSdcblxuXG4vLyBjYW52YXMgY29udGV4dFxubGV0IGN0eDogYW55ID0gbnVsbFxuLy8gdG91Y2ggZHJhd2luZ1xubGV0IGlzVG91Y2hpbmc6IGJvb2xlYW4gPSBmYWxzZVxubGV0IGJhY2tncm91bmRDb2xvciA9ICcjRkVGRUZFJ1xubGV0IHBlbiA9IHsgY29sb3I6ICcjMzMzMzMzJywgd2lkdGg6IDEgfVxubGV0IGRwciA9IDFcblxuLy8g5pe26Ze06L2077yM6K6w5b2V5pON5L2c5q2l6aqk5pWw5o2uXG5sZXQgdGltZUxpbmUgPSBbXVxuXG5QYWdlKHtcblxuICAvKipcbiAgICogUGFnZSBpbml0aWFsIGRhdGFcbiAgICovXG4gIGRhdGE6IHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiBMaWZlY3ljbGUgZnVuY3Rpb24tLUNhbGxlZCB3aGVuIHBhZ2UgbG9hZFxuICAgKi9cbiAgb25Mb2FkOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIGNvbnNvbGUubG9nKCdvbkxvYWQnKVxuICB9LFxuXG4gIC8qKlxuICAgKiBMaWZlY3ljbGUgZnVuY3Rpb24tLUNhbGxlZCB3aGVuIHBhZ2UgaXMgaW5pdGlhbGx5IHJlbmRlcmVkXG4gICAqL1xuICBvblJlYWR5OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pbml0Q29udGV4dCgpXG4gIH0sXG5cbiAgLyoqXG4gICAqIExpZmVjeWNsZSBmdW5jdGlvbi0tQ2FsbGVkIHdoZW4gcGFnZSBzaG93XG4gICAqL1xuICBvblNob3c6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiBMaWZlY3ljbGUgZnVuY3Rpb24tLUNhbGxlZCB3aGVuIHBhZ2UgaGlkZVxuICAgKi9cbiAgb25IaWRlOiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICogTGlmZWN5Y2xlIGZ1bmN0aW9uLS1DYWxsZWQgd2hlbiBwYWdlIHVubG9hZFxuICAgKi9cbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiBpbml0IGNhbnZhcyBjb250ZXh0XG4gICAqL1xuICBpbml0Q29udGV4dCAoKSB7XG4gICAgY29uc3QgeyBwaXhlbFJhdGlvLCB3aW5kb3dXaWR0aCwgd2luZG93SGVpZ2h0IH0gPSB3eC5nZXRTeXN0ZW1JbmZvU3luYygpXG4gICAgZHByID0gcGl4ZWxSYXRpb1xuICAgIGNvbnNvbGUubG9nKCdwaXhlbFJhdGlvJywgcGl4ZWxSYXRpbylcblxuICAgIGNvbnN0IHF1ZXJ5ID0gd3guY3JlYXRlU2VsZWN0b3JRdWVyeSgpXG4gICAgcXVlcnkuc2VsZWN0KCcjY2FudmFzJykubm9kZSgpLmV4ZWMoKHJlcykgPT4ge1xuICAgICAgY29uc3QgY2FudmFzID0gcmVzWzBdLm5vZGVcbiAgICAgIGNvbnNvbGUubG9nKCdjYW52YXMgLS0tICcsIGNhbnZhcylcbiAgICAgIGNhbnZhcy53aWR0aCA9IHdpbmRvd1dpZHRoICogZHByXG4gICAgICBjYW52YXMuaGVpZ2h0ID0gd2luZG93SGVpZ2h0ICogZHByXG5cbiAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpXG4gICAgICAvLyBjdHguc2NhbGUocGl4ZWxSYXRpbywgcGl4ZWxSYXRpbylcbiAgICAgIGNvbnNvbGUubG9nKCdjdHgnLCBjdHgpXG5cbiAgICAgIGN0eC5maWxsU3R5bGUgPSBiYWNrZ3JvdW5kQ29sb3JcbiAgICAgIGN0eC5maWxsUmVjdCgxNiwgMTYsIGN0eC5jYW52YXMud2lkdGggLSAzMiwgY3R4LmNhbnZhcy5oZWlnaHQgLSAzMilcbiAgICB9KVxuICB9LFxuXG4gIG9uVG91Y2hTdGFydCAoZXZlbnQ6IGFueSkgOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZygndG91Y2ggc3RhcnQgLS0gJywgZXZlbnQpXG4gICAgaXNUb3VjaGluZyA9IHRydWVcbiAgICB0aGlzLl9zdHJva2VCZWdpbihldmVudClcbiAgfSxcblxuICBvblRvdWNoTW92ZSAoZXZlbnQ6IGFueSkgOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZygndG91Y2ggbW92ZSAtLScsIGV2ZW50KVxuICAgIHRoaXMuX3N0cm9rZVVwZGF0ZShldmVudClcbiAgfSxcblxuICBvblRvdWNoRW5kIChldmVudDogYW55KSA6IHZvaWQge1xuICAgIGNvbnNvbGUubG9nKCd0b3VjaCBlbmQgLS0nLCBldmVudClcbiAgICBpc1RvdWNoaW5nID0gZmFsc2VcbiAgICB0aGlzLl9zdHJva2VFbmQoZXZlbnQpXG4gIH0sXG5cbiAgb25Ub3VjaENhbmNlbCAoZXZlbnQ6IGFueSkgOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZygndG91Y2ggY2FuY2VsJywgZXZlbnQpXG4gICAgaXNUb3VjaGluZyA9IGZhbHNlXG4gICAgdGhpcy5fc3Ryb2tlRW5kKGV2ZW50KVxuICB9LFxuXG4gIG9uRXJyb3IgKGV2ZW50OiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZygnY2FudmFzIGVycm9yJywgZXZlbnQpXG4gICAgaXNUb3VjaGluZyA9IGZhbHNlXG4gICAgdGhpcy5fc3Ryb2tlRW5kKGV2ZW50KVxuICB9LFxuXG4gIF9zdHJva2VCZWdpbiAoZXZlbnQ/OiBhbnkpIDogdm9pZCB7XG4gICAgY29uc3QgbmV3UG9pbnRHcm91cCA9IHtcbiAgICAgIGNvbG9yOiBwZW4uY29sb3IsXG4gICAgICBwb2ludHM6IFtdLFxuICAgIH07XG5cbiAgICB0aGlzLl9yZXNldCgpO1xuICAgIHRpbWVMaW5lLnB1c2gobmV3UG9pbnRHcm91cCk7XG4gICAgY29uc3Qge3gsIHl9ID0gZXZlbnQudG91Y2hlc1swXVxuICAgIGN0eC5iZWdpblBhdGgoKVxuICAgIHRoaXMuX21vdmVUbyh4LCB5KVxuICAgIHRoaXMuX2xpbmVUbyh4LCB5KVxuICAgIHRoaXMuX3N0cm9rZVVwZGF0ZShldmVudClcbiAgfSxcblxuICBfc3Ryb2tlVXBkYXRlIChldmVudDogYW55KSA6IHZvaWQge1xuICAgIC8vIGlmICh0aW1lTGluZS5sZW5ndGggPT09IDApIHtcbiAgICAvLyAgIHRoaXMuX3N0cm9rZVVwZGF0ZShldmVudClcbiAgICAvLyAgIHJldHVyblxuICAgIC8vIH1cblxuICAgIGNvbnN0IHt4LCB5fSA9IGV2ZW50LnRvdWNoZXNbMF1cbiAgICB0aGlzLl9saW5lVG8oeCwgeSlcbiAgICBjdHguc3Ryb2tlKClcbiAgfSxcblxuICBfc3Ryb2tlRW5kIChldmVudDogYW55KSA6IHZvaWQge1xuICAgIGN0eC5jbG9zZVBhdGgoKVxuICB9LFxuXG4gIF9jcmVhdGVQb2ludCh4OiBudW1iZXIsIHk6IG51bWJlcik6IFBvaW50IHtcbiAgICBjb25zdCB7bGVmdCwgdG9wfSA9IGN0eC5jYW52YXM7XG4gICAgcmV0dXJuIG5ldyBQb2ludCh4IC0gbGVmdCwgeSAtIHRvcCwgbmV3IERhdGUoKS5nZXRUaW1lKCkpO1xuICB9LFxuXG4gIF9kcmF3RG90ICgpIDogdm9pZCB7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuXG4gICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgIGN0eC5maWxsU3R5bGUgPSAnIzMzMzMzMyc7XG4gICAgY3R4LmZpbGwoKTtcbiAgfSxcblxuICBfbGluZVRvICh4OiBudW1iZXIsIHk6IG51bWJlcikgOiB2b2lkIHtcbiAgICBjdHgubGluZVRvKHggKiBkcHIsIHkgKiBkcHIpXG4gIH0sXG5cbiAgX21vdmVUbyAoeDogbnVtYmVyLCB5OiBudW1iZXIpIDogdm9pZCB7XG4gICAgY3R4Lm1vdmVUbyh4ICogZHByLCB5ICogZHByKVxuICB9LFxuXG4gIF9yZXNldCAoKSA6IHZvaWQge1xuICAgIC8vIHRoaXMuX2xhc3RQb2ludHMgPSBbXVxuICAgIC8vIHRoaXMuX2xhc3RWZWxvY2l0eSA9IDBcbiAgICAvLyB0aGlzLl9sYXN0V2lkdGggPSAodGhpcy5taW5XaWR0aCArIHRoaXMubWF4V2lkdGgpIC8gMlxuICAgIGN0eC5maWxsU3R5bGUgPSBwZW4uY29sb3JcbiAgfSxcblxuICBfY2xlYXIgKCkgOiB2b2lkIHtcbiAgICBjdHguZmlsbFN0eWxlID0gYmFja2dyb3VuZENvbG9yO1xuICAgIGN0eC5jbGVhclJlY3QoMTYsIDE2LCBjdHguY2FudmFzLndpZHRoIC0gMzIsIGN0eC5jYW52YXMuaGVpZ2h0IC0gMzIpXG4gICAgY3R4LmZpbGxSZWN0KDE2LCAxNiwgY3R4LmNhbnZhcy53aWR0aCAtIDMyLCBjdHguY2FudmFzLmhlaWdodCAtIDMyKVxuICAgIHRpbWVMaW5lID0gW11cbiAgICB0aGlzLl9yZXNldCgpXG4gIH0sXG5cbn0pIl19